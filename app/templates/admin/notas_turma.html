<!doctype html>
{% extends "base.html" %}

{% block title %}Notas Trimestrais{% endblock %}

{% block header %}
  <h1>Notas Trimestrais - {{ turma['designacao'] }}</h1>
{% endblock %}

{% block content %}
  <h2>Informações da Turma</h2>
  <p><strong>Designação:</strong> {{ turma['designacao'] }}</p>
  <p><strong>Classe:</strong> {{ turma['ano'] }}</p>
  <p><strong>Curso:</strong> {{ turma['curso_nome'] }} - {{ turma['curso_descricao'] }}</p>
  <p><strong>Ano Lectivo:</strong> {{ turma['ano_lectivo'] }}</p>

  <p><strong>Notas preenchidas:</strong> {{ total_preenchido }} / {{ total_esperado }}</p>

  <form method="get" action="{{ url_for('admin.notas_turma', id=turma['id']) }}">
    <label for="trimestre"><strong>Trimestre</strong></label>
    <select id="trimestre" name="trimestre" onchange="this.form.submit()">
      <option value="1" {% if trimestre == 1 %}selected{% endif %}>1º</option>
      <option value="2" {% if trimestre == 2 %}selected{% endif %}>2º</option>
      <option value="3" {% if trimestre == 3 %}selected{% endif %}>3º</option>
    </select>
  </form>

  <h2>Lançar/Editar Notas</h2>

  <form method="post" action="{{ url_for('admin.salvar_notas_turma', id=turma['id']) }}">
    <input type="hidden" name="trimestre" value="{{ trimestre }}">

    <table border="1">
      <thead>
        <tr>
          <th>Aluno</th>
          {% for disc in turma_disciplinas %}
            <th>{{ disc['disciplina_nome'] }}</th>
          {% endfor %}
        </tr>
      </thead>
      <tbody>
        {% for m in matriculas %}
          <tr>
            <td>{{ m['nome'] }}</td>
            {% for disc in turma_disciplinas %}
              {% set key = (m['matricula_id'], disc['turma_disciplina_id']) %}
              <td>
                <input
                  type="number"
                  name="nota-{{ m['matricula_id'] }}-{{ disc['turma_disciplina_id'] }}"
                  min="0"
                  max="20"
                  step="0.1"
                  value="{{ notas.get(key, '') }}"
                >
              </td>
            {% endfor %}
          </tr>
        {% endfor %}
      </tbody>
    </table>

    <button type="submit">Salvar notas do {{ trimestre }}º trimestre</button>
  </form>

  <a href="{{ url_for('admin.turma_detalhes', id=turma['id']) }}">Voltar para detalhes da turma</a>
{% endblock %}
